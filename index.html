<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™‚é–“å‰²ç®¡ç†ã‚¢ãƒ—ãƒª - è‡ªå‹•åŒæœŸç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .sync-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            font-size: 14px;
        }
        
        .sync-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4ade80;
            animation: pulse 2s infinite;
        }
        
        .sync-indicator.offline {
            background: #f87171;
            animation: none;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            overflow-x: auto;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
            white-space: nowrap;
            min-width: 120px;
        }
        
        .tab:hover {
            background: #e9ecef;
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .content {
            padding: 30px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .timetable-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
        }
        
        td {
            padding: 12px;
            text-align: center;
            border: 1px solid #dee2e6;
            min-height: 60px;
        }
        
        td input, td select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        td input:focus, td select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .time-label {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .date-selector {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .date-selector label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #495057;
        }
        
        .date-selector input {
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 16px;
            margin-right: 10px;
        }
        
        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .success-message {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            color: #155724;
            display: none;
        }
        
        .button-group {
            margin-top: 20px;
            text-align: center;
        }
        
        .date-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .date-navigation h2 {
            color: #495057;
            font-size: 24px;
        }
        
        .nav-buttons button {
            padding: 10px 20px;
            margin: 0 5px;
            border: none;
            border-radius: 6px;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }
        
        .nav-buttons button:hover {
            background: #5568d3;
        }
        
        .schedule-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            transition: transform 0.2s;
        }
        
        .schedule-item:hover {
            transform: translateX(5px);
            background: #f8f9fa;
        }
        
        .schedule-item:last-child {
            border-bottom: none;
        }
        
        .period-badge {
            min-width: 60px;
            padding: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            margin-right: 15px;
        }
        
        .class-badge {
            flex: 1;
            padding: 15px 20px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            color: white;
        }
        
        .empty-class {
            background: #e9ecef;
            color: #6c757d;
        }
        
        .week-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .week-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            font-size: 14px;
        }
        
        .week-table td {
            padding: 8px;
            border: 1px solid #dee2e6;
            text-align: center;
            min-width: 80px;
        }
        
        .week-cell {
            padding: 8px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            color: white;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .week-cell.empty {
            background: #e9ecef;
            color: #6c757d;
        }
        
        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .view-toggle button {
            flex: 1;
            padding: 12px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .view-toggle button.active {
            background: #667eea;
            color: white;
        }
        
        .view-toggle button:hover {
            background: #667eea;
            color: white;
        }
        
        .color-settings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .color-item {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .color-item label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #495057;
        }
        
        .color-item input[type="color"] {
            width: 100%;
            height: 50px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .color-preview {
            margin-top: 10px;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            color: white;
            font-weight: 600;
        }
        
        .quick-date-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .quick-date-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }
        
        .quick-date-btn:hover {
            background: #667eea;
            color: white;
        }
        
        .week-header {
            font-size: 12px;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š æ™‚é–“å‰²ç®¡ç†ã‚¢ãƒ—ãƒª - è‡ªå‹•åŒæœŸç‰ˆ</h1>
            <p>è‹±èªç§‘æ•™å“¡å‘ã‘ - ã™ã¹ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã§è‡ªå‹•åŒæœŸ</p>
            <div class="sync-status">
                <div class="sync-indicator" id="syncIndicator"></div>
                <span id="syncStatus">åŒæœŸæº–å‚™ä¸­...</span>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('view')">ğŸ“… äºˆå®šç¢ºèª</button>
            <button class="tab" onclick="switchTab('base')">ğŸ“ åŸºæœ¬æ™‚é–“å‰²</button>
            <button class="tab" onclick="switchTab('change')">ğŸ”„ æˆæ¥­å¤‰æ›´</button>
            <button class="tab" onclick="switchTab('colors')">ğŸ¨ è‰²è¨­å®š</button>
        </div>
        
        <div class="content">
            <!-- äºˆå®šç¢ºèªã‚¿ãƒ– -->
            <div id="view" class="tab-content active">
                <div class="info-box">
                    <h3>ğŸ“… äºˆå®šç¢ºèª</h3>
                    <p>æ—¥åˆ¥ã¾ãŸã¯é€±åˆ¥ã§æ™‚é–“å‰²ã‚’ç¢ºèªã§ãã¾ã™ã€‚ã‚¯ãƒ©ã‚¹ã”ã¨ã«è‰²åˆ†ã‘ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
                </div>
                
                <div class="view-toggle">
                    <button id="dayViewBtn" class="active" onclick="toggleView('day')">ğŸ“† æ—¥åˆ¥è¡¨ç¤º</button>
                    <button id="weekViewBtn" onclick="toggleView('week')">ğŸ“… é€±åˆ¥è¡¨ç¤º</button>
                </div>
                
                <!-- æ—¥åˆ¥è¡¨ç¤º -->
                <div id="dayView">
                    <div class="date-selector">
                        <label for="viewDate">æ—¥ä»˜ã‚’é¸æŠ:</label>
                        <input type="date" id="viewDate">
                        <button class="btn btn-primary" onclick="displayDaySchedule()">è¡¨ç¤º</button>
                        
                        <div class="quick-date-buttons">
                            <button class="quick-date-btn" onclick="setDateAndDisplay(0)">ä»Šæ—¥</button>
                            <button class="quick-date-btn" onclick="setDateAndDisplay(1)">æ˜æ—¥</button>
                            <button class="quick-date-btn" onclick="setDateAndDisplay(7)">1é€±é–“å¾Œ</button>
                        </div>
                    </div>
                    
                    <div class="calendar-view">
                        <div class="date-navigation">
                            <div class="nav-buttons">
                                <button onclick="navigateDate(-1)">â—€ å‰æ—¥</button>
                            </div>
                            <h2 id="displayDateTitle"></h2>
                            <div class="nav-buttons">
                                <button onclick="navigateDate(1)">æ¬¡æ—¥ â–¶</button>
                            </div>
                        </div>
                        
                        <div class="today-schedule" id="scheduleDisplay">
                            <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
                
                <!-- é€±åˆ¥è¡¨ç¤º -->
                <div id="weekView" style="display: none;">
                    <div class="date-selector">
                        <label for="weekStartDate">é€±ã®é–‹å§‹æ—¥ã‚’é¸æŠï¼ˆæœˆæ›œæ—¥ï¼‰:</label>
                        <input type="date" id="weekStartDate">
                        <button class="btn btn-primary" onclick="displayWeekSchedule()">è¡¨ç¤º</button>
                        
                        <div class="quick-date-buttons">
                            <button class="quick-date-btn" onclick="setWeekAndDisplay(0)">ä»Šé€±</button>
                            <button class="quick-date-btn" onclick="setWeekAndDisplay(1)">æ¥é€±</button>
                        </div>
                    </div>
                    
                    <div class="week-view">
                        <div class="date-navigation">
                            <div class="nav-buttons">
                                <button onclick="navigateWeek(-1)">â—€ å‰é€±</button>
                            </div>
                            <h2 id="weekDisplayTitle"></h2>
                            <div class="nav-buttons">
                                <button onclick="navigateWeek(1)">æ¬¡é€± â–¶</button>
                            </div>
                        </div>
                        
                        <div class="timetable-container">
                            <table class="week-table" id="weekScheduleTable">
                                <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- åŸºæœ¬æ™‚é–“å‰²ã‚¿ãƒ– -->
            <div id="base" class="tab-content">
                <div class="info-box">
                    <h3>åŸºæœ¬æ™‚é–“å‰²ã®è¨­å®š</h3>
                    <p>å¹´åº¦ã‚’é€šã—ã¦ä½¿ç”¨ã™ã‚‹åŸºæœ¬ã®é€±é–“æ™‚é–“å‰²ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚å¤‰æ›´ã¯è‡ªå‹•çš„ã«ã™ã¹ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã«åŒæœŸã•ã‚Œã¾ã™ã€‚</p>
                </div>
                
                <div class="timetable-container">
                    <table id="baseTimetable">
                        <thead>
                            <tr>
                                <th>æ™‚é™</th>
                                <th>æœˆæ›œæ—¥</th>
                                <th>ç«æ›œæ—¥</th>
                                <th>æ°´æ›œæ—¥</th>
                                <th>æœ¨æ›œæ—¥</th>
                                <th>é‡‘æ›œæ—¥</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- JavaScriptã§ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="saveBaseTimetable()">ğŸ’¾ åŸºæœ¬æ™‚é–“å‰²ã‚’ä¿å­˜</button>
                    <button class="btn btn-secondary" onclick="clearBaseTimetable()">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
                </div>
                
                <div id="saveMessage" class="success-message">
                    âœ… åŸºæœ¬æ™‚é–“å‰²ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ã™ã¹ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã«åŒæœŸã•ã‚Œã¾ã™ã€‚
                </div>
            </div>
            
            <!-- æˆæ¥­å¤‰æ›´ã‚¿ãƒ– -->
            <div id="change" class="tab-content">
                <div class="info-box">
                    <h3>æˆæ¥­å¤‰æ›´ã®è¨­å®š</h3>
                    <p>ç‰¹å®šã®æ—¥ä»˜ã®æ™‚é–“å‰²ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚å¤‰æ›´ã¯è‡ªå‹•çš„ã«ã™ã¹ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã«åŒæœŸã•ã‚Œã¾ã™ã€‚</p>
                </div>
                
                <div class="date-selector">
                    <label for="changeDate">ğŸ“… å¤‰æ›´ã™ã‚‹æ—¥ä»˜ã‚’é¸æŠ:</label>
                    <input type="date" id="changeDate">
                    <button class="btn btn-primary" onclick="loadDateTimetable()">èª­ã¿è¾¼ã¿</button>
                </div>
                
                <div id="selectedDateInfo" style="display:none; margin: 20px 0; padding: 15px; background: #fff3cd; border-radius: 8px;">
                    <strong>é¸æŠä¸­:</strong> <span id="selectedDateText"></span>
                </div>
                
                <div class="timetable-container">
                    <table id="changeTimetable">
                        <thead>
                            <tr>
                                <th>æ™‚é™</th>
                                <th>æˆæ¥­å†…å®¹</th>
                                <th>å¤‰æ›´</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- JavaScriptã§ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-success" onclick="saveChangeTimetable()">ğŸ’¾ ã“ã®æ—¥ã®æ™‚é–“å‰²ã‚’ä¿å­˜</button>
                    <button class="btn btn-secondary" onclick="clearAllChanges()">ğŸ—‘ï¸ ã™ã¹ã¦ã®å¤‰æ›´ã‚’ã‚¯ãƒªã‚¢</button>
                </div>
                
                <div id="changeMessage" class="success-message">
                    âœ… æˆæ¥­å¤‰æ›´ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ã™ã¹ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã«åŒæœŸã•ã‚Œã¾ã™ã€‚
                </div>
            </div>
            
            <!-- è‰²è¨­å®šã‚¿ãƒ– -->
            <div id="colors" class="tab-content">
                <div class="info-box">
                    <h3>ğŸ¨ ã‚¯ãƒ©ã‚¹åˆ¥ã®è‰²è¨­å®š</h3>
                    <p>å„ã‚¯ãƒ©ã‚¹ã®è¡¨ç¤ºè‰²ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚å¤‰æ›´ã¯è‡ªå‹•çš„ã«ã™ã¹ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã«åŒæœŸã•ã‚Œã¾ã™ã€‚</p>
                </div>
                
                <div class="color-settings">
                    <div class="color-item">
                        <label for="color-1-1">1-1ã®è‰²</label>
                        <input type="color" id="color-1-1" value="#667eea" onchange="updateColorPreview('1-1')">
                        <div class="color-preview" id="preview-1-1" style="background: #667eea;">1-1</div>
                    </div>
                    
                    <div class="color-item">
                        <label for="color-1-2">1-2ã®è‰²</label>
                        <input type="color" id="color-1-2" value="#f5576c" onchange="updateColorPreview('1-2')">
                        <div class="color-preview" id="preview-1-2" style="background: #f5576c;">1-2</div>
                    </div>
                    
                    <div class="color-item">
                        <label for="color-2-1">2-1ã®è‰²</label>
                        <input type="color" id="color-2-1" value="#00f2fe" onchange="updateColorPreview('2-1')">
                        <div class="color-preview" id="preview-2-1" style="background: #00f2fe;">2-1</div>
                    </div>
                    
                    <div class="color-item">
                        <label for="color-3-1">3-1ã®è‰²</label>
                        <input type="color" id="color-3-1" value="#38f9d7" onchange="updateColorPreview('3-1')">
                        <div class="color-preview" id="preview-3-1" style="background: #38f9d7;">3-1</div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="saveColors()">ğŸ’¾ è‰²è¨­å®šã‚’ä¿å­˜</button>
                    <button class="btn btn-secondary" onclick="resetColors()">ğŸ”„ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™</button>
                </div>
                
                <div id="colorMessage" class="success-message">
                    âœ… è‰²è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ã™ã¹ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã«åŒæœŸã•ã‚Œã¾ã™ã€‚
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        // Firebaseè¨­å®šï¼ˆåŸ‹ã‚è¾¼ã¿æ¸ˆã¿ï¼‰
        const firebaseConfig = {
            apiKey: "AIzaSyDOqoM1koJVXGmBB-LaTe9MczDm02zO9M",
            authDomain: "time-schedule-49fdc.firebaseapp.com",
            projectId: "time-schedule-49fdc",
            storageBucket: "time-schedule-49fdc.firebasestorage.app",
            messagingSenderId: "1095037674644",
            appId: "1:1095037674644:web:90c0ee33627fa53be40081"
        };
        
        // ã‚¯ãƒ©ã‚¹ä¸€è¦§
        const classes = ['', '1-1', '1-2', '2-1', '3-1'];
        const periods = 7;
        const days = ['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘'];
        
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è‰²è¨­å®š
        const defaultColors = {
            '1-1': '#667eea',
            '1-2': '#f5576c',
            '2-1': '#00f2fe',
            '3-1': '#38f9d7'
        };
        
        // Firebaseé–¢é€£
        let db = null;
        let isFirebaseConfigured = false;
        let isSyncing = false;
        let deviceId = localStorage.getItem('deviceId') || generateDeviceId();
        
        // ç¾åœ¨ã®è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰
        let currentView = 'day';
        
        // ãƒ‡ãƒã‚¤ã‚¹IDã‚’ç”Ÿæˆ
        function generateDeviceId() {
            const id = 'device_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('deviceId', id);
            return id;
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // Firebaseã‚’è‡ªå‹•åˆæœŸåŒ–
            initializeFirebase(firebaseConfig);
            
            // UIåˆæœŸåŒ–
            initBaseTimetable();
            initChangeTimetable();
            loadColors();
            
            // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¨­å®š
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('changeDate').value = today;
            document.getElementById('viewDate').value = today;
            
            // ä»Šé€±ã®æœˆæ›œæ—¥ã‚’è¨ˆç®—
            const todayDate = new Date();
            const dayOfWeek = todayDate.getDay();
            const diff = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
            const monday = new Date(todayDate);
            monday.setDate(todayDate.getDate() + diff);
            document.getElementById('weekStartDate').value = monday.toISOString().split('T')[0];
            
            // åˆå›è¡¨ç¤º
            displayDaySchedule();
        });
        
        // Firebaseã‚’åˆæœŸåŒ–
        function initializeFirebase(config) {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(config);
                }
                db = firebase.firestore();
                isFirebaseConfigured = true;
                
                // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œã‚’æœ‰åŠ¹åŒ–
                db.enablePersistence()
                    .catch((err) => {
                        console.warn('Persistenceæœ‰åŠ¹åŒ–ã‚¨ãƒ©ãƒ¼:', err);
                    });
                
                updateSyncStatus('online', 'åŒæœŸä¸­');
                
                // ãƒ‡ãƒ¼ã‚¿ã‚’Firebaseã‹ã‚‰èª­ã¿è¾¼ã¿
                syncFromFirebase();
                
                // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸã‚’è¨­å®š
                setupRealtimeSync();
                
            } catch (error) {
                console.error('FirebaseåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                updateSyncStatus('offline', 'Firebaseæ¥ç¶šã‚¨ãƒ©ãƒ¼');
                isFirebaseConfigured = false;
            }
        }
        
        // åŒæœŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°
        function updateSyncStatus(status, message) {
            const indicator = document.getElementById('syncIndicator');
            const statusText = document.getElementById('syncStatus');
            
            if (status === 'online') {
                indicator.classList.remove('offline');
            } else {
                indicator.classList.add('offline');
            }
            
            statusText.textContent = message;
        }
        
        // Firebaseã‹ã‚‰åŒæœŸ
        async function syncFromFirebase() {
            if (!isFirebaseConfigured || isSyncing) return;
            
            isSyncing = true;
            updateSyncStatus('online', 'åŒæœŸä¸­...');
            
            try {
                // åŸºæœ¬æ™‚é–“å‰²ã‚’å–å¾—
                const baseTimetableDoc = await db.collection('timetables').doc('base').get();
                if (baseTimetableDoc.exists) {
                    localStorage.setItem('baseTimetable', JSON.stringify(baseTimetableDoc.data()));
                }
                
                // æˆæ¥­å¤‰æ›´ã‚’å–å¾—
                const changesDoc = await db.collection('timetables').doc('changes').get();
                if (changesDoc.exists) {
                    localStorage.setItem('timetableChanges', JSON.stringify(changesDoc.data()));
                }
                
                // è‰²è¨­å®šã‚’å–å¾—
                const colorsDoc = await db.collection('timetables').doc('colors').get();
                if (colorsDoc.exists) {
                    localStorage.setItem('classColors', JSON.stringify(colorsDoc.data()));
                }
                
                // UIã‚’æ›´æ–°
                loadBaseTimetable();
                loadColors();
                if (currentView === 'day') {
                    displayDaySchedule();
                } else {
                    displayWeekSchedule();
                }
                
                updateSyncStatus('online', 'åŒæœŸå®Œäº† âœ“');
                localStorage.setItem('lastSync', new Date().toISOString());
                
            } catch (error) {
                console.error('åŒæœŸã‚¨ãƒ©ãƒ¼:', error);
                updateSyncStatus('offline', 'åŒæœŸã‚¨ãƒ©ãƒ¼');
            } finally {
                isSyncing = false;
            }
        }
        
        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸã‚’è¨­å®š
        function setupRealtimeSync() {
            if (!isFirebaseConfigured) return;
            
            // åŸºæœ¬æ™‚é–“å‰²ã®å¤‰æ›´ã‚’ç›£è¦–
            db.collection('timetables').doc('base').onSnapshot((doc) => {
                if (doc.exists && !isSyncing) {
                    localStorage.setItem('baseTimetable', JSON.stringify(doc.data()));
                    loadBaseTimetable();
                    if (currentView === 'day') {
                        displayDaySchedule();
                    } else {
                        displayWeekSchedule();
                    }
                    updateSyncStatus('online', 'æ›´æ–°ã‚’å—ä¿¡ âœ“');
                }
            });
            
            // æˆæ¥­å¤‰æ›´ã®å¤‰æ›´ã‚’ç›£è¦–
            db.collection('timetables').doc('changes').onSnapshot((doc) => {
                if (doc.exists && !isSyncing) {
                    localStorage.setItem('timetableChanges', JSON.stringify(doc.data()));
                    if (currentView === 'day') {
                        displayDaySchedule();
                    } else {
                        displayWeekSchedule();
                    }
                    updateSyncStatus('online', 'æ›´æ–°ã‚’å—ä¿¡ âœ“');
                }
            });
            
            // è‰²è¨­å®šã®å¤‰æ›´ã‚’ç›£è¦–
            db.collection('timetables').doc('colors').onSnapshot((doc) => {
                if (doc.exists && !isSyncing) {
                    localStorage.setItem('classColors', JSON.stringify(doc.data()));
                    loadColors();
                    if (currentView === 'day') {
                        displayDaySchedule();
                    } else {
                        displayWeekSchedule();
                    }
                    updateSyncStatus('online', 'æ›´æ–°ã‚’å—ä¿¡ âœ“');
                }
            });
        }
        
        // Firebaseã«ä¿å­˜
        async function saveToFirebase(docName, data) {
            if (!isFirebaseConfigured) {
                console.log('ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰: Firebaseã¸ã®ä¿å­˜ã‚’ã‚¹ã‚­ãƒƒãƒ—');
                return true;
            }
            
            try {
                isSyncing = true;
                updateSyncStatus('online', 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...');
                
                await db.collection('timetables').doc(docName).set(data, { merge: true });
                
                updateSyncStatus('online', 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº† âœ“');
                localStorage.setItem('lastSync', new Date().toISOString());
                
                return true;
            } catch (error) {
                console.error('Firebaseä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                updateSyncStatus('offline', 'ä¿å­˜ã‚¨ãƒ©ãƒ¼');
                return false;
            } finally {
                isSyncing = false;
            }
        }
        
        // ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆ
        function toggleView(view) {
            currentView = view;
            
            document.getElementById('dayViewBtn').classList.remove('active');
            document.getElementById('weekViewBtn').classList.remove('active');
            
            if (view === 'day') {
                document.getElementById('dayViewBtn').classList.add('active');
                document.getElementById('dayView').style.display = 'block';
                document.getElementById('weekView').style.display = 'none';
                displayDaySchedule();
            } else {
                document.getElementById('weekViewBtn').classList.add('active');
                document.getElementById('dayView').style.display = 'none';
                document.getElementById('weekView').style.display = 'block';
                displayWeekSchedule();
            }
        }
        
        // åŸºæœ¬æ™‚é–“å‰²ãƒ†ãƒ¼ãƒ–ãƒ«ã®åˆæœŸåŒ–
        function initBaseTimetable() {
            const tbody = document.querySelector('#baseTimetable tbody');
            tbody.innerHTML = '';
            
            for (let i = 1; i <= periods; i++) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="time-label">${i}é™</td>
                    ${days.map(day => `
                        <td>
                            <select id="base_${day}_${i}">
                                ${classes.map(cls => `<option value="${cls}">${cls}</option>`).join('')}
                            </select>
                        </td>
                    `).join('')}
                `;
                tbody.appendChild(row);
            }
            
            loadBaseTimetable();
        }
        
        // æˆæ¥­å¤‰æ›´ãƒ†ãƒ¼ãƒ–ãƒ«ã®åˆæœŸåŒ–
        function initChangeTimetable() {
            const tbody = document.querySelector('#changeTimetable tbody');
            tbody.innerHTML = '';
            
            for (let i = 1; i <= periods; i++) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="time-label">${i}é™</td>
                    <td>
                        <select id="change_${i}" data-period="${i}">
                            ${classes.map(cls => `<option value="${cls}">${cls}</option>`).join('')}
                        </select>
                    </td>
                    <td>
                        <input type="checkbox" id="changed_${i}" data-period="${i}">
                        <label for="changed_${i}">å¤‰æ›´</label>
                    </td>
                `;
                tbody.appendChild(row);
            }
        }
        
        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        
        // åŸºæœ¬æ™‚é–“å‰²ã‚’ä¿å­˜
        async function saveBaseTimetable() {
            const timetable = {};
            
            days.forEach(day => {
                timetable[day] = [];
                for (let i = 1; i <= periods; i++) {
                    const select = document.getElementById(`base_${day}_${i}`);
                    timetable[day].push(select.value);
                }
            });
            
            localStorage.setItem('baseTimetable', JSON.stringify(timetable));
            await saveToFirebase('base', timetable);
            showMessage('saveMessage');
        }
        
        // åŸºæœ¬æ™‚é–“å‰²ã‚’èª­ã¿è¾¼ã¿
        function loadBaseTimetable() {
            const saved = localStorage.getItem('baseTimetable');
            if (!saved) return;
            
            const timetable = JSON.parse(saved);
            
            days.forEach(day => {
                if (timetable[day]) {
                    timetable[day].forEach((cls, index) => {
                        const select = document.getElementById(`base_${day}_${index + 1}`);
                        if (select) select.value = cls;
                    });
                }
            });
        }
        
        // åŸºæœ¬æ™‚é–“å‰²ã‚’ã‚¯ãƒªã‚¢
        function clearBaseTimetable() {
            if (confirm('åŸºæœ¬æ™‚é–“å‰²ã‚’ã‚¯ãƒªã‚¢ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                days.forEach(day => {
                    for (let i = 1; i <= periods; i++) {
                        const select = document.getElementById(`base_${day}_${i}`);
                        if (select) select.value = '';
                    }
                });
            }
        }
        
        // æŒ‡å®šæ—¥ã®æ™‚é–“å‰²ã‚’å–å¾—
        function getTimetableForDate(dateStr) {
            const [year, month, day] = dateStr.split('-').map(Number);
            const date = new Date(year, month - 1, day);
            const dayIndex = date.getDay();
            
            if (dayIndex === 0 || dayIndex === 6) {
                return Array(periods).fill('');
            }
            
            const dayName = days[dayIndex - 1];
            const baseTimetable = JSON.parse(localStorage.getItem('baseTimetable') || '{}');
            const changes = JSON.parse(localStorage.getItem('timetableChanges') || '{}');
            
            let schedule = Array(periods).fill('');
            if (baseTimetable[dayName] && Array.isArray(baseTimetable[dayName])) {
                baseTimetable[dayName].forEach((cls, index) => {
                    if (index < periods) {
                        schedule[index] = cls || '';
                    }
                });
            }
            
            if (changes[dateStr] && Array.isArray(changes[dateStr])) {
                changes[dateStr].forEach((change, index) => {
                    if (change !== null && change !== undefined && index < periods) {
                        schedule[index] = change;
                    }
                });
            }
            
            return schedule;
        }
        
        // æŒ‡å®šæ—¥ã®æ™‚é–“å‰²ã‚’èª­ã¿è¾¼ã¿
        function loadDateTimetable() {
            const dateInput = document.getElementById('changeDate');
            const selectedDate = dateInput.value;
            
            if (!selectedDate) {
                alert('æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            const dateInfo = document.getElementById('selectedDateInfo');
            const dateText = document.getElementById('selectedDateText');
            const [year, month, day] = selectedDate.split('-').map(Number);
            const date = new Date(year, month - 1, day);
            const dayOfWeek = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'][date.getDay()];
            dateText.textContent = `${selectedDate} (${dayOfWeek})`;
            dateInfo.style.display = 'block';
            
            const schedule = getTimetableForDate(selectedDate);
            const changes = JSON.parse(localStorage.getItem('timetableChanges') || '{}');
            const dateChanges = changes[selectedDate] || {};
            
            for (let i = 1; i <= periods; i++) {
                const select = document.getElementById(`change_${i}`);
                const checkbox = document.getElementById(`changed_${i}`);
                
                if (select) {
                    select.value = schedule[i - 1] || '';
                }
                
                if (checkbox) {
                    checkbox.checked = dateChanges[i - 1] !== null && dateChanges[i - 1] !== undefined;
                }
            }
        }
        
        // æˆæ¥­å¤‰æ›´ã‚’ä¿å­˜
        async function saveChangeTimetable() {
            const dateInput = document.getElementById('changeDate');
            const selectedDate = dateInput.value;
            
            if (!selectedDate) {
                alert('æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            const changes = JSON.parse(localStorage.getItem('timetableChanges') || '{}');
            
            if (!changes[selectedDate]) {
                changes[selectedDate] = Array(periods).fill(null);
            }
            
            for (let i = 1; i <= periods; i++) {
                const checkbox = document.getElementById(`changed_${i}`);
                const select = document.getElementById(`change_${i}`);
                
                if (checkbox && checkbox.checked && select) {
                    changes[selectedDate][i - 1] = select.value;
                } else {
                    changes[selectedDate][i - 1] = null;
                }
            }
            
            if (changes[selectedDate].every(item => item === null)) {
                delete changes[selectedDate];
            }
            
            localStorage.setItem('timetableChanges', JSON.stringify(changes));
            await saveToFirebase('changes', changes);
            showMessage('changeMessage');
        }
        
        // ã™ã¹ã¦ã®å¤‰æ›´ã‚’ã‚¯ãƒªã‚¢
        async function clearAllChanges() {
            if (confirm('ã“ã®æ—¥ã®æˆæ¥­å¤‰æ›´ã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                const dateInput = document.getElementById('changeDate');
                const selectedDate = dateInput.value;
                
                if (selectedDate) {
                    const changes = JSON.parse(localStorage.getItem('timetableChanges') || '{}');
                    delete changes[selectedDate];
                    localStorage.setItem('timetableChanges', JSON.stringify(changes));
                    await saveToFirebase('changes', changes);
                    
                    for (let i = 1; i <= periods; i++) {
                        const checkbox = document.getElementById(`changed_${i}`);
                        if (checkbox) checkbox.checked = false;
                    }
                    
                    loadDateTimetable();
                }
            }
        }
        
        // æ—¥ä»˜ã”ã¨ã®äºˆå®šã‚’è¡¨ç¤º
        function displayDaySchedule() {
            const dateInput = document.getElementById('viewDate');
            const selectedDate = dateInput.value;
            
            if (!selectedDate) {
                alert('æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            const [year, month, day] = selectedDate.split('-').map(Number);
            const date = new Date(year, month - 1, day);
            const dayOfWeek = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'][date.getDay()];
            
            const title = document.getElementById('displayDateTitle');
            title.textContent = `${selectedDate} (${dayOfWeek})`;
            
            const schedule = getTimetableForDate(selectedDate);
            const display = document.getElementById('scheduleDisplay');
            display.innerHTML = '';
            
            if (schedule.length === 0 || schedule.every(item => !item)) {
                display.innerHTML = '<div style="padding: 40px; text-align: center; color: #6c757d;"><h3>ã“ã®æ—¥ã®äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“</h3></div>';
                return;
            }
            
            const colors = JSON.parse(localStorage.getItem('classColors') || JSON.stringify(defaultColors));
            
            for (let i = 0; i < periods; i++) {
                const cls = schedule[i] || '';
                const item = document.createElement('div');
                item.className = 'schedule-item';
                
                const badge = document.createElement('div');
                badge.className = 'period-badge';
                badge.textContent = `${i + 1}é™`;
                
                const classInfo = document.createElement('div');
                classInfo.className = 'class-badge';
                
                if (cls) {
                    classInfo.textContent = `è‹±èª - ${cls}`;
                    classInfo.style.background = colors[cls] || defaultColors[cls] || '#6c757d';
                } else {
                    classInfo.textContent = 'ç©ºãã‚³ãƒ';
                    classInfo.classList.add('empty-class');
                }
                
                item.appendChild(badge);
                item.appendChild(classInfo);
                display.appendChild(item);
            }
        }
        
        // é€±é–“äºˆå®šã‚’è¡¨ç¤º
        function displayWeekSchedule() {
            const dateInput = document.getElementById('weekStartDate');
            let startDate = dateInput.value;
            
            if (!startDate) {
                alert('é€±ã®é–‹å§‹æ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            const [year, month, day] = startDate.split('-').map(Number);
            const date = new Date(year, month - 1, day);
            const dayOfWeek = date.getDay();
            const diff = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
            date.setDate(date.getDate() + diff);
            
            const mondayYear = date.getFullYear();
            const mondayMonth = String(date.getMonth() + 1).padStart(2, '0');
            const mondayDay = String(date.getDate()).padStart(2, '0');
            startDate = `${mondayYear}-${mondayMonth}-${mondayDay}`;
            dateInput.value = startDate;
            
            const endDate = new Date(date.getFullYear(), date.getMonth(), date.getDate() + 4);
            const endDateStr = `${endDate.getFullYear()}-${String(endDate.getMonth() + 1).padStart(2, '0')}-${String(endDate.getDate()).padStart(2, '0')}`;
            const title = document.getElementById('weekDisplayTitle');
            title.textContent = `${startDate} ã€œ ${endDateStr}`;
            
            const table = document.getElementById('weekScheduleTable');
            table.innerHTML = '';
            
            const colors = JSON.parse(localStorage.getItem('classColors') || JSON.stringify(defaultColors));
            
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            headerRow.innerHTML = '<th>æ™‚é™</th>';
            
            for (let i = 0; i < 5; i++) {
                const currentDate = new Date(date.getFullYear(), date.getMonth(), date.getDate() + i);
                const dateStr = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-${String(currentDate.getDate()).padStart(2, '0')}`;
                const dayName = days[i];
                headerRow.innerHTML += `<th>${dayName}<br><span class="week-header">${dateStr}</span></th>`;
            }
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            const tbody = document.createElement('tbody');
            for (let period = 0; period < periods; period++) {
                const row = document.createElement('tr');
                row.innerHTML = `<td class="time-label">${period + 1}é™</td>`;
                
                for (let day = 0; day < 5; day++) {
                    const currentDate = new Date(date.getFullYear(), date.getMonth(), date.getDate() + day);
                    const dateStr = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-${String(currentDate.getDate()).padStart(2, '0')}`;
                    
                    const schedule = getTimetableForDate(dateStr);
                    const cls = schedule[period] || '';
                    
                    const cell = document.createElement('td');
                    const cellContent = document.createElement('div');
                    cellContent.className = 'week-cell';
                    
                    if (cls) {
                        cellContent.textContent = cls;
                        cellContent.style.background = colors[cls] || defaultColors[cls] || '#6c757d';
                    } else {
                        cellContent.textContent = '-';
                        cellContent.classList.add('empty');
                    }
                    
                    cell.appendChild(cellContent);
                    row.appendChild(cell);
                }
                
                tbody.appendChild(row);
            }
            table.appendChild(tbody);
        }
        
        // æ—¥ä»˜ã‚’ãƒŠãƒ“ã‚²ãƒ¼ãƒˆ
        function navigateDate(offset) {
            const dateInput = document.getElementById('viewDate');
            const currentDateStr = dateInput.value;
            
            if (!currentDateStr) {
                alert('æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            const [year, month, day] = currentDateStr.split('-').map(Number);
            const currentDate = new Date(year, month - 1, day);
            currentDate.setDate(currentDate.getDate() + offset);
            
            const newDate = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-${String(currentDate.getDate()).padStart(2, '0')}`;
            dateInput.value = newDate;
            displayDaySchedule();
        }
        
        // é€±ã‚’ãƒŠãƒ“ã‚²ãƒ¼ãƒˆ
        function navigateWeek(offset) {
            const dateInput = document.getElementById('weekStartDate');
            const currentDateStr = dateInput.value;
            
            if (!currentDateStr) {
                alert('é€±ã®é–‹å§‹æ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            const [year, month, day] = currentDateStr.split('-').map(Number);
            const currentDate = new Date(year, month - 1, day);
            currentDate.setDate(currentDate.getDate() + (offset * 7));
            
            const newDate = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-${String(currentDate.getDate()).padStart(2, '0')}`;
            dateInput.value = newDate;
            displayWeekSchedule();
        }
        
        // æ—¥ä»˜ã‚’è¨­å®šã—ã¦è¡¨ç¤º
        function setDateAndDisplay(daysOffset) {
            const dateInput = document.getElementById('viewDate');
            const date = new Date();
            date.setDate(date.getDate() + daysOffset);
            
            const dateStr = date.toISOString().split('T')[0];
            dateInput.value = dateStr;
            displayDaySchedule();
        }
        
        // é€±ã‚’è¨­å®šã—ã¦è¡¨ç¤º
        function setWeekAndDisplay(weeksOffset) {
            const date = new Date();
            const dayOfWeek = date.getDay();
            const diff = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
            date.setDate(date.getDate() + diff + (weeksOffset * 7));
            
            const dateStr = date.toISOString().split('T')[0];
            document.getElementById('weekStartDate').value = dateStr;
            displayWeekSchedule();
        }
        
        // è‰²è¨­å®šã‚’èª­ã¿è¾¼ã¿
        function loadColors() {
            const saved = localStorage.getItem('classColors');
            const colors = saved ? JSON.parse(saved) : defaultColors;
            
            Object.keys(colors).forEach(cls => {
                const input = document.getElementById(`color-${cls}`);
                const preview = document.getElementById(`preview-${cls}`);
                if (input && preview) {
                    input.value = colors[cls];
                    preview.style.background = colors[cls];
                }
            });
        }
        
        // è‰²ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
        function updateColorPreview(cls) {
            const input = document.getElementById(`color-${cls}`);
            const preview = document.getElementById(`preview-${cls}`);
            if (input && preview) {
                preview.style.background = input.value;
            }
        }
        
        // è‰²è¨­å®šã‚’ä¿å­˜
        async function saveColors() {
            const colors = {};
            ['1-1', '1-2', '2-1', '3-1'].forEach(cls => {
                const input = document.getElementById(`color-${cls}`);
                if (input) {
                    colors[cls] = input.value;
                }
            });
            
            localStorage.setItem('classColors', JSON.stringify(colors));
            await saveToFirebase('colors', colors);
            showMessage('colorMessage');
        }
        
        // è‰²è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆ
        async function resetColors() {
            if (confirm('è‰²è¨­å®šã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ')) {
                localStorage.setItem('classColors', JSON.stringify(defaultColors));
                await saveToFirebase('colors', defaultColors);
                loadColors();
            }
        }
        
        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        function showMessage(messageId) {
            const message = document.getElementById(messageId);
            message.style.display = 'block';
            setTimeout(() => {
                message.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>